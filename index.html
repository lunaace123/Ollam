
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Swing ¬∑ gym & diet</title>
    <!-- Font Awesome (icons) & Firebase compat SDKs -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
        }

        body {
            background: #f5f7fb;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        #app {
            width: 100%;
            max-width: 430px;
            background: white;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.05);
            border-radius: 32px 32px 0 0;
            overflow: hidden;
            position: relative;
            height: 95vh;
            display: flex;
            flex-direction: column;
            margin: 10px;
        }

        /* Auth screens */
        #authView {
            padding: 24px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
            background: linear-gradient(145deg, #f0f4fe, #ffffff);
        }

        .auth-card {
            background: white;
            border-radius: 32px;
            padding: 28px 20px;
            box-shadow: 0 10px 25px rgba(0, 20, 50, 0.1);
            width: 100%;
        }

        .logo {
            font-size: 2.4rem;
            font-weight: 700;
            color: #1e2b4f;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: -0.5px;
        }

        .logo span {
            color: #ff7b4a;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            font-weight: 500;
            font-size: 0.9rem;
            color: #2e3a5c;
            display: block;
            margin-bottom: 5px;
        }

        .input-group input {
            width: 100%;
            padding: 15px 18px;
            border: 1.5px solid #e3e9f2;
            border-radius: 24px;
            font-size: 1rem;
            transition: 0.2s;
            background: #fafcff;
        }

        .input-group input:focus {
            border-color: #ff7b4a;
            outline: none;
        }

        .btn {
            background: #1e2b4f;
            color: white;
            border: none;
            padding: 16px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 1.1rem;
            width: 100%;
            margin-top: 8px;
            transition: 0.2s;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-secondary {
            background: #ff7b4a;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .toggle-auth {
            text-align: center;
            margin-top: 20px;
            color: #5f6b8a;
        }

        .toggle-auth button {
            background: none;
            border: none;
            color: #ff7b4a;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
        }

        /* Main App layout */
        .main-app {
            display: none;
            flex-direction: column;
            height: 100%;
            background: #f8faff;
        }

        .header {
            padding: 20px 18px 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            border-bottom: 1px solid #eef2f8;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 1.9rem;
            font-weight: 700;
            color: #1e2b4f;
        }

        .header h1 span {
            color: #ff7b4a;
        }

        .header .user-icon {
            font-size: 1.4rem;
            color: #2e3a5c;
            background: #f0f4fe;
            padding: 10px;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .bell-icon {
            font-size: 1.3rem;
            color: #2e3a5c;
            background: #f0f4fe;
            padding: 10px;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
        }

        .bell-icon .badge {
            position: absolute;
            top: 2px;
            right: 2px;
            background: #ff7b4a;
            color: white;
            font-size: 0.65rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            border: 2px solid white;
        }

        /* Content Area */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 18px 16px 120px;
            scroll-behavior: smooth;
        }

        /* Bottom navigation */
        .bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            padding: 12px 10px 25px;
            background: white;
            border-top: 1px solid #eef2f8;
            box-shadow: 0 -2px 15px rgba(0, 0, 0, 0.02);
            z-index: 10;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #8a99b5;
            transition: 0.2s;
            font-size: 0.75rem;
            cursor: pointer;
        }

        .nav-item i {
            font-size: 1.5rem;
            margin-bottom: 3px;
        }

        .nav-item.active {
            color: #ff7b4a;
            font-weight: 600;
        }

        /* Cards & UI elements */
        .section-title {
            font-weight: 600;
            color: #1e2b4f;
            margin: 24px 0 12px;
            font-size: 1.2rem;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
        }

        .circle-card {
            background: white;
            border-radius: 24px;
            padding: 18px 10px;
            text-align: center;
            box-shadow: 0 8px 18px #e9edf4;
        }

        .progress-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 10px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: 1s ease-out;
        }

        .progress-circle inner {
            background: white;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.4rem;
            color: #1e2b4f;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            background: white;
            padding: 16px;
            border-radius: 28px;
        }

        .cal-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            background: #f5f8ff;
            border-radius: 12px;
            font-size: 0.9rem;
            color: #1e2b4f;
            cursor: pointer;
        }

        .cal-day.checked {
            background: #ff7b4a;
            color: white;
            font-weight: 600;
        }

        .cal-day.today {
            border: 2px solid #ff7b4a;
        }

        /* Search & Food */
        .search-box {
            display: flex;
            background: white;
            border-radius: 44px;
            padding: 5px 5px 5px 20px;
            margin: 15px 0;
            border: 1px solid #e9eef6;
            width: 100%;
        }

        .search-box input {
            flex: 1;
            border: none;
            background: none;
            padding: 12px 0;
            font-size: 1rem;
        }

        .search-box input:focus {
            outline: none;
        }

        .search-box button {
            background: #1e2b4f;
            border: none;
            color: white;
            width: 48px;
            border-radius: 40px;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .food-item {
            background: white;
            padding: 14px 18px;
            border-radius: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.02);
        }

        .food-info {
            display: flex;
            flex-direction: column;
        }

        .food-name {
            font-weight: 600;
            color: #1e2b4f;
        }

        .food-meta {
            font-size: 0.8rem;
            color: #8a99b5;
        }

        .food-stats {
            font-weight: 700;
            color: #ff7b4a;
        }

        /* Chat system */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 400px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px 5px;
            display: flex;
            flex-direction: column;
        }

        .bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 24px;
            margin-bottom: 10px;
            font-size: 0.95rem;
            line-height: 1.4;
            position: relative;
        }

        .bubble .sender {
            font-size: 0.75rem;
            font-weight: 700;
            margin-bottom: 4px;
            display: block;
        }

        .bubble.me {
            background: #1e2b4f;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 6px;
        }

        .bubble.other {
            background: #e9effa;
            color: #1e2b4f;
            align-self: flex-start;
            border-bottom-left-radius: 6px;
        }

        .chat-footer {
            display: flex;
            gap: 8px;
            background: white;
            padding: 10px;
            border-radius: 40px;
            margin-top: 15px;
            border: 1px solid #eef2f8;
        }

        .chat-footer input {
            flex: 1;
            border: none;
            background: #f0f4fe;
            border-radius: 40px;
            padding: 14px 18px;
            font-size: 1rem;
        }

        .chat-footer input:focus {
            outline: none;
        }

        .send-btn {
            background: none;
            border: none;
            font-size: 1.3rem;
            color: #ff7b4a;
            cursor: pointer;
            padding: 0 10px;
        }

        /* Leaderboard */
        .leaderboard-item {
            display: flex;
            align-items: center;
            background: white;
            padding: 12px 18px;
            border-radius: 40px;
            margin-bottom: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.02);
            cursor: pointer;
            transition: 0.2s;
        }

        .leaderboard-item:active {
            transform: scale(0.98);
            background: #f0f4fe;
        }

        .rank {
            font-weight: 800;
            width: 35px;
            color: #ff7b4a;
            font-size: 1.1rem;
        }

        .name {
            flex: 1;
            font-weight: 600;
            color: #1e2b4f;
        }

        .score {
            background: #eef2f8;
            padding: 6px 14px;
            border-radius: 40px;
            font-size: 0.85rem;
            font-weight: 700;
            color: #1e2b4f;
        }

        .online-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #42e672;
            display: inline-block;
            margin-left: 8px;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(66, 230, 114, 0.5);
        }

        /* Settings */
        .settings-option {
            background: white;
            padding: 18px 22px;
            border-radius: 24px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.02);
        }

        .settings-option span:first-child {
            font-weight: 600;
            color: #1e2b4f;
        }

        .settings-val {
            color: #8a99b5;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .small-note {
            font-size: 0.8rem;
            color: #8895b7;
            margin: 8px 0;
            text-align: center;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Modal for Goal / Profile Edit */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-card {
            background: white;
            border-radius: 32px;
            padding: 30px 24px;
            width: 100%;
            max-width: 350px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div id="app">
        <!-- AUTH View -->
        <div id="authView">
            <div class="auth-card">
                <div class="logo">Swing<span>.</span></div>
                <div id="loginForm">
                    <div class="input-group"><label>Email</label><input type="email" id="loginEmail"
                            placeholder="your@email.com"></div>
                    <div class="input-group"><label>Password</label><input type="password" id="loginPassword"
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
                    <button class="btn" id="loginBtn">Log in</button>
                </div>
                <div id="registerForm" style="display:none;">
                    <div class="input-group"><label>Display name</label><input type="text" id="regName"
                            placeholder="Swing User"></div>
                    <div class="input-group"><label>Email</label><input type="email" id="regEmail"
                            placeholder="your@email.com"></div>
                    <div class="input-group"><label>Password</label><input type="password" id="regPassword"
                            placeholder="min 6 chars"></div>
                    <button class="btn btn-secondary" id="registerBtn">Register</button>
                </div>
                <div class="toggle-auth">
                    <span id="toggleTxt">No account?</span> <button id="toggleAuthBtn">Register</button>
                </div>
            </div>
        </div>

        <!-- MAIN APP View -->
        <div id="mainApp" class="main-app">
            <div class="header">
                <h1>Swing<span>.</span></h1>
                <div class="header-actions">
                    <div id="notifBell" class="bell-icon"><i class="fas fa-bell"></i><span id="notifBadge" class="badge"
                            style="display:none;">0</span></div>
                    <div class="user-icon" id="headerProfileIcon"><i class="fas fa-user-circle"></i></div>
                </div>
            </div>

            <!-- dynamic content sections -->
            <div class="content" id="contentArea">
                <!-- home section (progress circles) -->
                <div class="section active" id="homeSection">
                    <div class="section-title">Today's protein</div>
                    <div class="circle-card">
                        <div class="progress-circle" id="proteinCircle"
                            style="background: conic-gradient(#ff7b4a 0deg, #eef2f8 0deg);">
                            <inner id="proteinText">0g</inner>
                        </div>
                        <div style="display:flex; gap:12px; justify-content:center; margin-top:16px;">
                            <button class="btn" style="padding:10px 20px; width:auto; font-size: 0.9rem;"
                                id="addProteinBtn">+20g</button>
                            <button class="btn btn-secondary" style="padding:10px 20px; width:auto; font-size: 0.9rem;"
                                id="setGoalBtn">Goal</button>
                        </div>
                        <div class="small-note" style="margin-top: 10px;" id="proteinTargetNote">Goal: 120g</div>
                    </div>

                    <div class="section-title">Consistency</div>
                    <div class="grid-2">
                        <div class="circle-card">
                            <div class="progress-circle" id="weekCircle"
                                style="background:conic-gradient(#ff7b4a 0deg 0deg, #eef2f8 0deg 360deg); height: 80px; width: 80px;">
                                <inner style="width:65px; height:65px; font-size: 1.1rem;" id="weekPct">0%</inner>
                            </div><span style="font-size: 0.8rem; font-weight: 600;">week</span>
                        </div>
                        <div class="circle-card">
                            <div class="progress-circle" id="monthCircle"
                                style="background:conic-gradient(#1e2b4f 0deg 0deg, #eef2f8 0deg 360deg); height: 80px; width: 80px;">
                                <inner style="width:65px; height:65px; font-size: 1.1rem;" id="monthPct">0%</inner>
                            </div><span style="font-size: 0.8rem; font-weight: 600;">month</span>
                        </div>
                    </div>

                    <div class="section-title">Manual Diet Entry</div>
                    <div
                        style="background:white; border-radius:28px; padding:18px; box-shadow: 0 4px 10px rgba(0,0,0,0.02);">
                        <div class="input-group"><label>Quick Add Calories</label><input type="number" id="quickCal"
                                placeholder="e.g. 500" style="padding: 12px 18px;"></div>
                        <button class="btn" style="padding:12px;" id="saveQuickAdd">Sync Daily Goal</button>
                    </div>
                </div>

                <!-- calendar section -->
                <div class="section" id="calendarSection">
                    <div class="section-title" id="calMonthTitle">March 2025</div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                    <div class="small-note">Tap day to mark protein goal ‚úì</div>
                    <div
                        style="margin-top:20px; background:white; border-radius:28px; padding:20px; box-shadow: 0 4px 10px rgba(0,0,0,0.02);">
                        <div style="margin-bottom: 10px; font-weight: 600;">Month Streak <span
                                style="float:right; color:#1e2b4f;" id="monthStreakVal">0%</span></div>
                        <div style="width:100%; height:8px; background:#f0f4fe; border-radius:10px; overflow:hidden;">
                            <div id="monthBar" style="width:0%; height:100%; background:#ff7b4a; transition: 1s;"></div>
                        </div>
                    </div>
                </div>

                <!-- leaderboard section -->
                <div class="section" id="leaderboardSection">
                    <div class="section-title">üèÜ consistency leaderboard</div>
                    <div id="leaderboardList"></div>
                    <div class="section-title">üîç search people</div>
                    <div class="search-box"><input placeholder="username..." id="searchPeopleInput"><button
                            id="searchPeopleBtn"><i class="fas fa-search"></i></button></div>
                    <div id="searchResults"></div>
                </div>

                <!-- chat section -->
                <div class="section" id="chatSection">
                    <div style="display:flex; gap:10px; margin-bottom:15px;">
                        <button class="btn" style="padding:10px; flex:1; font-size: 0.9rem;" id="showPublicChat">üí¨
                            public lounge</button>
                        <button class="btn btn-secondary" style="padding:10px; flex:1; font-size: 0.9rem;"
                            id="showPrivateChat">üîê private chats</button>
                    </div>
                    <div id="publicChatPanel">
                        <div class="chat-container">
                            <div class="chat-messages" id="publicMessages"></div>
                            <div class="chat-footer"><input id="publicMsgInput" placeholder="Write something..."><button
                                    class="send-btn" id="sendPublicBtn"><i class="fas fa-paper-plane"></i></button>
                            </div>
                        </div>
                    </div>
                    <div id="privateChatPanel" style="display:none;">
                        <div id="privateList"></div>
                        <div id="chatInterface" style="display:none;">
                            <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;"><button
                                    class="btn" style="width:40px; height:40px; padding:0;" id="backToPrivateList"><i
                                        class="fas fa-arrow-left"></i></button>
                                <h4 id="activeChatName">Chatting...</h4>
                            </div>
                            <div class="chat-container">
                                <div class="chat-messages" id="privateMessages"></div>
                                <div class="chat-footer"><input id="privateMsgInput"
                                        placeholder="Private msg..."><button class="send-btn" id="sendPrivateBtn"><i
                                            class="fas fa-paper-plane"></i></button></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- food search section -->
                <div class="section" id="foodSection">
                    <div class="section-title">üçè Kerala & world foods</div>
                    <div class="search-box"><input id="foodSearchInput" placeholder="e.g. alfam, mandhi, egg"><button
                            id="foodSearchBtn"><i class="fas fa-search"></i></button></div>
                    <div id="foodResults"></div>
                </div>

                <!-- settings section -->
                <div class="section" id="settingsSection">
                    <div class="section-title">‚öôÔ∏è profile setup</div>
                    <div class="settings-option"><span>Display Name</span>
                        <div class="settings-val" id="editNameBtn"><span id="displayNameSetting">Swing User</span> <i
                                class="fas fa-chevron-right"></i></div>
                    </div>
                    <div class="settings-option"><span>Daily Protein (g)</span>
                        <div class="settings-val" id="editProteinBtn"><span id="proteinGoalSetting">120g</span> <i
                                class="fas fa-chevron-right"></i></div>
                    </div>
                    <div class="settings-option"><span>Notifications</span> <i class="fas fa-toggle-on"
                            style="color:#ff7b4a; font-size:1.8rem;"></i></div>
                    <button class="btn" id="logoutBtn" style="background:#ff7b4a; margin-top: 20px;">Log out</button>
                </div>

                <!-- Notifications section -->
                <div class="section" id="notificationsSection">
                    <div class="section-title">üîî Notifications</div>
                    <div id="notificationList">
                        <div class="small-note">No new notifications.</div>
                    </div>
                </div>
            </div>

            <!-- Bottom Navigation -->
            <div class="bottom-nav">
                <div class="nav-item active" data-section="homeSection"><i class="fas fa-home"></i><span>Home</span>
                </div>
                <div class="nav-item" data-section="calendarSection"><i
                        class="fas fa-calendar-alt"></i><span>History</span></div>
                <div class="nav-item" data-section="leaderboardSection"><i class="fas fa-trophy"></i><span>Ranks</span>
                </div>
                <div class="nav-item" data-section="chatSection"><i class="fas fa-comment-dots"></i><span>Social</span>
                </div>
                <div class="nav-item" data-section="foodSection"><i class="fas fa-utensils"></i><span>Food</span></div>
                <div class="nav-item" data-section="settingsSection"><i class="fas fa-sliders-h"></i><span>More</span>
                </div>
            </div>
        </div>

        <!-- GOAL MODAL -->
        <div class="modal" id="goalModal">
            <div class="modal-card">
                <h3 style="margin-bottom: 20px; color:#1e2b4f;">Update Protein Goal</h3>
                <div class="input-group"><label>Goal in grams</label><input type="number" id="newGoalInput"
                        placeholder="120"></div>
                <div style="display:flex; gap:10px;">
                    <button class="btn" style="flex:1;" id="saveGoalBtn">Save</button>
                    <button class="btn btn-secondary" style="flex:1; background:#8a99b5;"
                        id="closeGoalModal">Cancel</button>
                </div>
            </div>
        </div>

        <!-- NAME MODAL -->
        <div class="modal" id="nameModal">
            <div class="modal-card">
                <h3 style="margin-bottom: 20px; color:#1e2b4f;">Edit Name</h3>
                <div class="input-group"><label>Display Name</label><input type="text" id="newNameInput"
                        placeholder="Username"></div>
                <div style="display:flex; gap:10px;">
                    <button class="btn" style="flex:1;" id="saveNameBtn">Save</button>
                    <button class="btn btn-secondary" style="flex:1; background:#8a99b5;"
                        id="closeNameModal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAHrBE3doAhDni4mcNhylJD8o3r5cNZYSI",
            authDomain: "ls-mannage.firebaseapp.com",
            databaseURL: "https://ls-mannage-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "ls-mannage",
            storageBucket: "ls-mannage.firebasestorage.app",
            messagingSenderId: "115534926798",
            appId: "1:115534926798:web:4ea3ab3c1a2d44e2e1d19f",
            measurementId: "G-P2JQH8M41Y"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // State
        let currentUser = null;
        let currentProfile = null;
        let activeSection = 'homeSection';
        let proteinToday = 0;
        let currentTarget = 120;
        let activePrivateChatUid = null;
        let unreadNotifications = 0;

        // Food Database (Expanded with Manglish/Malayalam support)
        const foodDB = [
            // SADYA & TRADITIONAL VEGETARIAN DISHES
            { name: "Kaalan (‡¥ï‡¥æ‡¥≥‡µª)", kcal: 120, protein: 3, cat: "Sadhya", alt: "kalan" },
            { name: "Pachadi - Pineapple/Beetroot (‡¥™‡¥ö‡µç‡¥ö‡¥ü‡¥ø)", kcal: 140, protein: 2, cat: "Sadhya", alt: "pachadi" },
            { name: "Kichadi (‡¥ï‡¥ø‡¥ö‡µç‡¥ö‡¥ü‡¥ø)", kcal: 130, protein: 2, cat: "Sadhya", alt: "kichadi" },
            { name: "Parippu Curry (‡¥™‡¥∞‡¥ø‡¥™‡µç‡¥™‡µç ‡¥ï‡¥±‡¥ø)", kcal: 150, protein: 8, cat: "Sadhya", alt: "parippu" },
            { name: "Cherupayar Curry (‡¥ö‡µÜ‡¥±‡µÅ‡¥™‡¥Ø‡µº ‡¥ï‡¥±‡¥ø)", kcal: 160, protein: 9, cat: "Sadhya", alt: "cherupayar" },
            { name: "Mambazha Pulissery (‡¥Æ‡¥æ‡¥Æ‡µç‡¥™‡¥¥ ‡¥™‡µÅ‡¥≥‡¥ø‡¥∂‡µç‡¥∂‡µá‡¥∞‡¥ø)", kcal: 110, protein: 2, cat: "Sadhya", alt: "pulissery" },
            { name: "Naranga Curry (‡¥®‡¥æ‡¥∞‡¥ô‡µç‡¥ô ‡¥ï‡¥±‡¥ø)", kcal: 90, protein: 1, cat: "Sadhya", alt: "naranga pickle" },
            { name: "Manga Curry (‡¥Æ‡¥æ‡¥ô‡µç‡¥ô ‡¥ï‡¥±‡¥ø)", kcal: 95, protein: 1, cat: "Sadhya", alt: "manga pickle" },
            { name: "Cabbage Thoran (‡¥ï‡¥æ‡¥¨‡µá‡¥ú‡µç ‡¥§‡µã‡¥∞‡µª)", kcal: 95, protein: 3, cat: "Sadhya", alt: "thoran" },
            { name: "Beetroot Thoran (‡¥¨‡µÄ‡¥±‡µç‡¥±‡µç‡¥±‡µÇ‡¥ü‡µç‡¥ü‡µç ‡¥§‡µã‡¥∞‡µª)", kcal: 100, protein: 2, cat: "Sadhya", alt: "thoran" },
            { name: "Vendakka Mezhukkupuratti (‡¥µ‡µÜ‡¥£‡µç‡¥ü‡¥Ø‡µç‡¥ï‡µç‡¥ï ‡¥Æ‡µÜ‡¥¥‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥™‡µÅ‡¥∞‡¥ü‡µç‡¥ü‡¥ø)", kcal: 85, protein: 2, cat: "Side", alt: "vendakka" },
            { name: "Kovakka Fry (‡¥ï‡µã‡¥µ‡¥Ø‡µç‡¥ï‡µç‡¥ï ‡¥´‡µç‡¥∞‡µà)", kcal: 90, protein: 2, cat: "Side", alt: "kovakka" },
            { name: "Pavakka Fry (‡¥™‡¥æ‡¥µ‡¥Ø‡µç‡¥ï‡µç‡¥ï ‡¥´‡µç‡¥∞‡µà)", kcal: 110, protein: 2, cat: "Side", alt: "pavakka" },
            { name: "Urula Kizhangu Roast (‡¥â‡¥∞‡µÅ‡¥≥‡¥ï‡µç‡¥ï‡¥ø‡¥¥‡¥ô‡µç‡¥ô‡µç ‡¥±‡µã‡¥∏‡µç‡¥±‡µç‡¥±‡µç)", kcal: 150, protein: 3, cat: "Side", alt: "potato roast" },
            { name: "Puli Inji (‡¥™‡µÅ‡¥≥‡¥ø ‡¥á‡¥û‡µç‡¥ö‡¥ø)", kcal: 130, protein: 1, cat: "Sadhya", alt: "inji curry" },
            { name: "Upperi - Sharkkara Varatti (‡¥â‡¥™‡µç‡¥™‡µá‡¥∞‡¥ø)", kcal: 480, protein: 2, cat: "Snack", alt: "upperi sharkara" },
            { name: "Papadam (‡¥™‡¥™‡µç‡¥™‡¥ü‡¥Ç)", kcal: 512, protein: 25, cat: "Sadhya", alt: "pappadam" },

            // FISH & SEAFOOD
            { name: "Mathi Fry - Sardine (‡¥Æ‡¥§‡µç‡¥§‡¥ø ‡¥´‡µç‡¥∞‡µà)", kcal: 200, protein: 22, cat: "Fish", alt: "mathi" },
            { name: "Ayala Fry - Mackerel (‡¥Ö‡¥Ø‡¥≤ ‡¥´‡µç‡¥∞‡µà)", kcal: 220, protein: 21, cat: "Fish", alt: "ayala" },
            { name: "Neymeen Fry - Seer Fish (‡¥®‡µÜ‡¥Ø‡µç‡¥Æ‡µÄ‡µª ‡¥´‡µç‡¥∞‡µà)", kcal: 240, protein: 23, cat: "Fish", alt: "neymeen" },
            { name: "Kanava Roast - Squid (‡¥ï‡¥£‡¥µ ‡¥±‡µã‡¥∏‡µç‡¥±‡µç‡¥±‡µç)", kcal: 175, protein: 18, cat: "Seafood", alt: "kanava" },
            { name: "Chemmeen Theeyal (‡¥ö‡µÜ‡¥Æ‡µç‡¥Æ‡µÄ‡µª ‡¥§‡µÄ‡¥Ø‡µΩ)", kcal: 160, protein: 17, cat: "Seafood", alt: "chemmeen" },
            { name: "Crab Masala (‡¥û‡¥£‡µç‡¥ü‡µç ‡¥Æ‡¥∏‡¥æ‡¥≤)", kcal: 190, protein: 18, cat: "Seafood", alt: "crab nhandu" },
            { name: "Dry Fish Chammanthi (‡¥â‡¥£‡¥ï‡µç‡¥ï‡¥Æ‡µÄ‡µª ‡¥ö‡¥Æ‡µç‡¥Æ‡¥®‡µç‡¥§‡¥ø)", kcal: 250, protein: 30, cat: "Fish", alt: "unakkameen" },
            { name: "Meen Peera (‡¥Æ‡µÄ‡µª ‡¥™‡µÄ‡¥∞)", kcal: 150, protein: 16, cat: "Fish", alt: "peera" },
            { name: "Fish Cutlet (‡¥´‡¥ø‡¥∑‡µç ‡¥ï‡¥ü‡µç‡¥ü‡µç‡¥≤‡¥±‡µç‡¥±‡µç)", kcal: 260, protein: 14, cat: "Fish", alt: "cutlet" },

            // CHICKEN DISHES
            { name: "Chicken Varutharachathu (‡¥ö‡¥ø‡¥ï‡µç‡¥ï‡µª ‡¥µ‡¥±‡µÅ‡¥§‡µç‡¥§‡¥∞‡¥ö‡µç‡¥ö‡¥§‡µç)", kcal: 240, protein: 22, cat: "Chicken", alt: "chicken curry" },
            { name: "Chicken Chukka (‡¥ö‡¥ø‡¥ï‡µç‡¥ï‡µª ‡¥ö‡µÅ‡¥ï‡µç‡¥ï)", kcal: 230, protein: 21, cat: "Chicken", alt: "chukka" },
            { name: "Chicken Kondattam (‡¥ö‡¥ø‡¥ï‡µç‡¥ï‡µª ‡¥ï‡µä‡¥£‡µç‡¥ü‡¥æ‡¥ü‡µç‡¥ü‡¥Ç)", kcal: 260, protein: 20, cat: "Chicken", alt: "kondattam" },
            { name: "Chicken 65 Kerala Style (‡¥ö‡¥ø‡¥ï‡µç‡¥ï‡µª 65)", kcal: 300, protein: 23, cat: "Chicken", alt: "65" },
            { name: "Chicken Cutlet (‡¥ö‡¥ø‡¥ï‡µç‡¥ï‡µª ‡¥ï‡¥ü‡µç‡¥ü‡µç‡¥≤‡¥±‡µç‡¥±‡µç)", kcal: 280, protein: 15, cat: "Chicken", alt: "cutlet" },
            { name: "Chicken Puffs (‡¥ö‡¥ø‡¥ï‡µç‡¥ï‡µª ‡¥™‡¥´‡µç‡¥∏‡µç)", kcal: 320, protein: 9, cat: "Bakery", alt: "puff" },
            { name: "Chicken Kizhi Parotta (‡¥ï‡¥ø‡¥¥‡¥ø ‡¥™‡µä‡¥±‡µã‡¥ü‡µç‡¥ü)", kcal: 350, protein: 18, cat: "Main", alt: "kizhi" },

            // BEEF / PORK / MUTTON
            { name: "Beef Chilli (‡¥¨‡µÄ‡¥´‡µç ‡¥ö‡¥ø‡¥≤‡µç‡¥≤‡¥ø)", kcal: 290, protein: 25, cat: "Beef", alt: "beef" },
            { name: "Beef Fry Coconut Style (‡¥¨‡µÄ‡¥´‡µç ‡¥´‡µç‡¥∞‡µà)", kcal: 320, protein: 27, cat: "Beef", alt: "beef olathiyathu bdf" },
            { name: "Beef Cutlet (‡¥¨‡µÄ‡¥´‡µç ‡¥ï‡¥ü‡µç‡¥ü‡µç‡¥≤‡¥±‡µç‡¥±‡µç)", kcal: 300, protein: 16, cat: "Beef", alt: "cutlet" },
            { name: "Pork Vindaloo (‡¥™‡µã‡µº‡¥ï‡µç‡¥ï‡µç ‡¥µ‡¥ø‡¥®‡µç‡¥§‡¥æ‡¥≤‡µÅ)", kcal: 310, protein: 26, cat: "Pork", alt: "pork" },
            { name: "Pork Roast (‡¥™‡µã‡µº‡¥ï‡µç‡¥ï‡µç ‡¥±‡µã‡¥∏‡µç‡¥±‡µç‡¥±‡µç)", kcal: 330, protein: 28, cat: "Pork", alt: "pork" },
            { name: "Mutton Chaps (‡¥Æ‡¥ü‡µç‡¥ü‡µª ‡¥ö‡¥æ‡¥™‡µç‡¥∏‡µç)", kcal: 300, protein: 25, cat: "Mutton", alt: "mutton" },
            { name: "Mutton Stew (‡¥Æ‡¥ü‡µç‡¥ü‡µª ‡¥∏‡µç‡¥±‡µç‡¥±‡µç‡¥Ø‡µÇ)", kcal: 240, protein: 23, cat: "Mutton", alt: "stew" },

            // MALABAR SPECIALS
            { name: "Coin Porotta (‡¥ï‡µã‡¥Ø‡¥ø‡µª ‡¥™‡µä‡¥±‡µã‡¥ü‡µç‡¥ü)", kcal: 320, protein: 6, cat: "Bread", alt: "porotta" },
            { name: "Kothu Porotta (‡¥ï‡µä‡¥§‡µç‡¥§‡µÅ ‡¥™‡µä‡¥±‡µã‡¥ü‡µç‡¥ü)", kcal: 350, protein: 12, cat: "Main", alt: "kothu" },
            { name: "Meen Pathiri (‡¥Æ‡µÄ‡µª ‡¥™‡¥§‡µç‡¥§‡¥ø‡¥∞‡¥ø)", kcal: 290, protein: 14, cat: "Malabar", alt: "pathiri" },
            { name: "Chicken Al Faham (‡¥Ö‡µΩ ‡¥´‡¥π‡¥Ç)", kcal: 220, protein: 25, cat: "Malabar", alt: "alfaham farooj" },
            { name: "Mandhi (‡¥Æ‡¥®‡µç‡¥§‡¥ø)", kcal: 210, protein: 18, cat: "Malabar", alt: "kuzhimanthi mandhi" },
            { name: "Mutta Thengapal (‡¥Æ‡µÅ‡¥ü‡µç‡¥ü ‡¥§‡µá‡¥ô‡µç‡¥ô‡¥æ‡¥™‡µç‡¥™‡¥æ‡µΩ)", kcal: 240, protein: 7, cat: "Malabar", alt: "egg curry" },
            { name: "Ottada (‡¥ì‡¥ü‡µç‡¥ü‡¥ü)", kcal: 200, protein: 4, cat: "Malabar", alt: "ada" },

            // TRIBAL & RURAL
            { name: "Ragi Mudde (‡¥∞‡¥æ‡¥ó‡¥ø ‡¥Æ‡µÅ‡¥¶‡µç‡¥¶)", kcal: 180, protein: 5, cat: "Tribal", alt: "ragi" },
            { name: "Kambu Porridge (‡¥ï‡¥Æ‡µç‡¥™‡µç ‡¥ï‡¥û‡µç‡¥û‡¥ø)", kcal: 150, protein: 4, cat: "Tribal", alt: "kanji" },
            { name: "Bamboo Shoot Curry (‡¥Æ‡µÅ‡¥≥‡¥ô‡µç‡¥ï‡¥Æ‡µç‡¥™‡µç ‡¥ï‡¥±‡¥ø)", kcal: 90, protein: 2, cat: "Tribal", alt: "mulamkambu" },
            { name: "Wild Boar Curry (‡¥ï‡¥æ‡¥ü‡µç‡¥ü‡µÅ‡¥™‡¥®‡µç‡¥®‡¥ø ‡¥ï‡¥±‡¥ø)", kcal: 250, protein: 24, cat: "Tribal", alt: "panni curry" },
            { name: "Tapioca Leaf Curry (‡¥ö‡µÄ‡¥®‡¥ø ‡¥á‡¥≤ ‡¥ï‡¥±‡¥ø)", kcal: 100, protein: 3, cat: "Tribal", alt: "kappa ila" },

            // BREADS & RICE
            { name: "Ghee Rice (‡¥®‡µÜ‡¥Ø‡µç‚Äå‡¥ö‡µã‡¥±‡µç)", kcal: 210, protein: 4, cat: "Rice", alt: "neychoru" },
            { name: "Jeerakasala Rice (‡¥ú‡µÄ‡¥∞‡¥ï‡¥∂‡¥æ‡¥≤ ‡¥Ö‡¥∞‡¥ø)", kcal: 130, protein: 3, cat: "Rice", alt: "kaima biriyani rice" },
            { name: "Lemon Rice Kerala Style (‡¥®‡¥æ‡¥∞‡¥ô‡µç‡¥ô ‡¥ö‡µã‡¥±‡µç)", kcal: 180, protein: 4, cat: "Rice", alt: "naranga choru" },
            { name: "Tamarind Rice (‡¥™‡µÅ‡¥≥‡¥ø‡¥û‡µç‡¥ö‡µã‡¥±‡µç)", kcal: 200, protein: 5, cat: "Rice", alt: "pulinchoru" },
            { name: "Coconut Rice (‡¥§‡µá‡¥ô‡µç‡¥ô ‡¥ö‡µã‡¥±‡µç)", kcal: 220, protein: 4, cat: "Rice", alt: "thenga choru" },
            { name: "Wheat Dosa (‡¥ó‡µã‡¥§‡¥Æ‡µç‡¥™‡µç ‡¥¶‡µã‡¥∂)", kcal: 170, protein: 5, cat: "Bread", alt: "gothambu dosa" },
            { name: "Ragi Dosa (‡¥∞‡¥æ‡¥ó‡¥ø ‡¥¶‡µã‡¥∂)", kcal: 160, protein: 4, cat: "Bread", alt: "ragi dosa" },
            { name: "Chapati (‡¥ö‡¥™‡µç‡¥™‡¥æ‡¥§‡µç‡¥§‡¥ø)", kcal: 120, protein: 3, cat: "Bread", alt: "chappathi" },

            // STREET FOOD
            { name: "Kerala Shawarma (‡¥∑‡¥µ‡µº‡¥Æ)", kcal: 250, protein: 15, cat: "Street", alt: "shawarma" },
            { name: "Egg Puffs (‡¥Æ‡µÅ‡¥ü‡µç‡¥ü ‡¥™‡¥´‡µç‡¥∏‡µç)", kcal: 300, protein: 8, cat: "Bakery", alt: "puff" },
            { name: "Veg Cutlet (‡¥µ‡µÜ‡¥ú‡µç ‡¥ï‡¥ü‡µç‡¥ü‡µç‡¥≤‡¥±‡µç‡¥±‡µç)", kcal: 240, protein: 5, cat: "Street", alt: "cutlet" },
            { name: "Samosa Kerala Style (‡¥∏‡¥Æ‡µã‡¥∏)", kcal: 300, protein: 6, cat: "Street", alt: "samosa" },
            { name: "Bonda (‡¥¨‡µã‡¥£‡µç‡¥ü)", kcal: 280, protein: 4, cat: "Street", alt: "bonda" },
            { name: "Pazham Nirachathu (‡¥™‡¥¥‡¥Ç ‡¥®‡¥ø‡¥±‡¥ö‡µç‡¥ö‡¥§‡µç)", kcal: 310, protein: 3, cat: "Street", alt: "pazham" },

            // PAYASAM VARIETY
            { name: "Gothambu Payasam (‡¥ó‡µã‡¥§‡¥Æ‡µç‡¥™‡µç ‡¥™‡¥æ‡¥Ø‡¥∏‡¥Ç)", kcal: 260, protein: 6, cat: "Dessert", alt: "payasam" },
            { name: "Aval Payasam (‡¥Ö‡¥µ‡µΩ ‡¥™‡¥æ‡¥Ø‡¥∏‡¥Ç)", kcal: 240, protein: 5, cat: "Dessert", alt: "payasam" },
            { name: "Carrot Payasam (‡¥ï‡¥æ‡¥∞‡¥±‡µç‡¥±‡µç ‡¥™‡¥æ‡¥Ø‡¥∏‡¥Ç)", kcal: 220, protein: 4, cat: "Dessert", alt: "payasam" },
            { name: "Rice Payasam (‡¥Ö‡¥∞‡¥ø ‡¥™‡¥æ‡¥Ø‡¥∏‡¥Ç)", kcal: 230, protein: 4, cat: "Dessert", alt: "payasam" },
            { name: "Paneer Payasam (‡¥™‡¥®‡µÄ‡µº ‡¥™‡¥æ‡¥Ø‡¥∏‡¥Ç)", kcal: 300, protein: 10, cat: "Dessert", alt: "payasam" },
            { name: "Palada Payasam (‡¥™‡¥æ‡¥≤‡¥ü ‡¥™‡¥æ‡¥Ø‡¥∏‡¥Ç)", kcal: 350, protein: 6, cat: "Dessert", alt: "palada" },

            // MORE SWEETS
            { name: "Ela Ada (‡¥á‡¥≤ ‡¥Ö‡¥ü)", kcal: 230, protein: 4, cat: "Snack", alt: "ada" },
            { name: "Chatti Pathiri Sweet (‡¥ö‡¥ü‡µç‡¥ü‡¥ø‡¥™‡µç‡¥™‡¥§‡µç‡¥§‡¥ø‡¥∞‡¥ø)", kcal: 350, protein: 9, cat: "Malabar", alt: "pathiri" },
            { name: "Kozhikodan Banana Halwa (‡¥π‡µΩ‡¥µ)", kcal: 390, protein: 2, cat: "Sweet", alt: "halwa alpaisa" },
            { name: "Coconut Barfi (‡¥§‡µá‡¥ô‡µç‡¥ô ‡¥¨‡µº‡¥´‡¥ø)", kcal: 450, protein: 4, cat: "Sweet", alt: "barfi" },
            { name: "Milk Cake Kerala (‡¥Æ‡¥ø‡µΩ‡¥ï‡µç‡¥ï‡µç ‡¥ï‡µá‡¥ï‡µç‡¥ï‡µç)", kcal: 370, protein: 8, cat: "Sweet", alt: "cake" },
            { name: "Jaggery Laddu (‡¥≤‡¥°‡µÅ)", kcal: 380, protein: 6, cat: "Sweet", alt: "laddu laddoo" },

            // PICKLES & SIDES
            { name: "Mango Pickle (‡¥Æ‡¥æ‡¥ô‡µç‡¥ô ‡¥Ö‡¥ö‡µç‡¥ö‡¥æ‡µº)", kcal: 120, protein: 1, cat: "Pickle", alt: "manga achar" },
            { name: "Lemon Pickle (‡¥®‡¥æ‡¥∞‡¥ô‡µç‡¥ô ‡¥Ö‡¥ö‡µç‡¥ö‡¥æ‡µº)", kcal: 100, protein: 1, cat: "Pickle", alt: "naranga achar" },
            { name: "Fish Pickle (‡¥Æ‡µÄ‡µª ‡¥Ö‡¥ö‡µç‡¥ö‡¥æ‡µº)", kcal: 220, protein: 15, cat: "Pickle", alt: "meen achar" },
            { name: "Prawn Pickle (‡¥ö‡µÜ‡¥Æ‡µç‡¥Æ‡µÄ‡µª ‡¥Ö‡¥ö‡µç‡¥ö‡¥æ‡µº)", kcal: 230, protein: 18, cat: "Pickle", alt: "chemmeen achar" },
            { name: "Chammanthi Podi (‡¥ö‡¥Æ‡µç‡¥Æ‡¥®‡µç‡¥§‡¥ø ‡¥™‡µä‡¥ü‡¥ø)", kcal: 400, protein: 12, cat: "Side", alt: "podi" },
            { name: "Coconut Chutney (‡¥§‡µá‡¥ô‡µç‡¥ô ‡¥ö‡¥Æ‡µç‡¥Æ‡¥®‡µç‡¥§‡¥ø)", kcal: 200, protein: 3, cat: "Side", alt: "chammanthi" },
            // Gym
            { name: "Chicken Breast (100g)", cal: 165, protein: 31, cat: "Gym" },
            { name: "Egg Whites (5)", cal: 85, protein: 20, cat: "Gym" },
            { name: "Whole Egg (1)", cal: 70, protein: 6, cat: "Gym" },
            { name: "Oats (100g)", cal: 389, protein: 17, cat: "Gym" },
            { name: "Peanut Butter (1 tbsp)", cal: 95, protein: 4, cat: "Gym" },
            { name: "Whey Protein (1 scoop)", cal: 120, protein: 25, cat: "Gym" }
        ];

        // UI Handlers
        const $ = id => document.getElementById(id);

        // Toggle Login/Register
        $('toggleAuthBtn').onclick = () => {
            const isLogin = $('loginForm').style.display !== 'none';
            $('loginForm').style.display = isLogin ? 'none' : 'block';
            $('registerForm').style.display = isLogin ? 'block' : 'none';
            $('toggleAuthBtn').innerText = isLogin ? 'Login' : 'Register';
            $('toggleTxt').innerText = isLogin ? 'Already have account?' : 'No account?';
        };

        // Login
        $('loginBtn').onclick = () => {
            const email = $('loginEmail').value, pass = $('loginPassword').value;
            auth.signInWithEmailAndPassword(email, pass).catch(err => alert(err.message));
        };

        // Register
        $('registerBtn').onclick = () => {
            const name = $('regName').value, email = $('regEmail').value, pass = $('regPassword').value;
            auth.createUserWithEmailAndPassword(email, pass).then(cred => {
                const uid = cred.user.uid;
                db.ref('users/' + uid).set({ username: name, email, proteinGoal: 120, consistency: 0, points: 0 });
            }).catch(err => alert(err.message));
        };

        // Auth State
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                $('authView').style.display = 'none';
                $('mainApp').style.display = 'flex';
                db.ref('users/' + user.uid).on('value', snap => {
                    currentProfile = snap.val();
                    updateProfileUI();
                });
                db.ref('presence/' + user.uid).set(true);
                db.ref('presence/' + user.uid).onDisconnect().remove();
                loadPublicMessages();
                generateCalendar();
                loadLeaderboard();
                syncProtein();
                listenForNotifs();
            } else {
                $('authView').style.display = 'flex';
                $('mainApp').style.display = 'none';
                currentUser = null;
            }
        });

        function updateProfileUI() {
            if (!currentProfile) return;
            $('displayNameSetting').innerText = currentProfile.username;
            $('proteinGoalSetting').innerText = currentProfile.proteinGoal + 'g';
            $('proteinTargetNote').innerText = 'Goal: ' + currentProfile.proteinGoal + 'g';
            currentTarget = currentProfile.proteinGoal;
            updateCircles();
        }

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.onclick = () => {
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                item.classList.add('active');
                const target = item.dataset.section;
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                $(target).classList.add('active');
                activeSection = target;
                if (target === 'calendarSection') generateCalendar();
            };
        });

        // Protein Logic
        function syncProtein() {
            const today = new Date().toISOString().split('T')[0];
            db.ref(`users/${currentUser.uid}/logs/${today}/protein`).on('value', snap => {
                proteinToday = snap.val() || 0;
                updateCircles();
            });
        }

        function updateCircles() {
            const pct = Math.min(100, (proteinToday / currentTarget) * 100);
            const angle = pct * 3.6;
            $('proteinCircle').style.background = `conic-gradient(#ff7b4a 0deg ${angle}deg, #eef2f8 ${angle}deg 360deg)`;
            $('proteinText').innerText = proteinToday + 'g';

            // Mock Week/Month
            $('weekPct').innerText = '75%';
            $('monthPct').innerText = '62%';
            $('weekCircle').style.background = `conic-gradient(#ff7b4a 0deg ${75 * 3.6}deg, #eef2f8 ${75 * 3.6}deg 360deg)`;
            $('monthCircle').style.background = `conic-gradient(#1e2b4f 0deg ${62 * 3.6}deg, #eef2f8 ${62 * 3.6}deg 360deg)`;
        }

        $('addProteinBtn').onclick = () => {
            const today = new Date().toISOString().split('T')[0];
            const newCount = proteinToday + 20;
            db.ref(`users/${currentUser.uid}/logs/${today}`).update({ protein: newCount });
            if (newCount >= currentTarget) db.ref(`users/${currentUser.uid}/checks/${today}`).set(true);
        };

        // Save Quick add (Calories placeholder)
        $('saveQuickAdd').onclick = () => {
            const cal = $('quickCal').value;
            if (!cal) return;
            const today = new Date().toISOString().split('T')[0];
            db.ref(`users/${currentUser.uid}/logs/${today}`).update({ calories: parseInt(cal) });
            alert("Calories synced!");
            $('quickCal').value = '';
        };

        // Calendar
        function generateCalendar() {
            const grid = $('calendarGrid');
            grid.innerHTML = '';
            const now = new Date();
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            $('calMonthTitle').innerText = now.toLocaleString('default', { month: 'long', year: 'numeric' });

            db.ref(`users/${currentUser.uid}/checks`).once('value', snap => {
                const checks = snap.val() || {};
                let count = 0;
                for (let i = 1; i <= daysInMonth; i++) {
                    const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                    const day = document.createElement('div');
                    day.className = 'cal-day';
                    if (checks[dateStr]) { day.classList.add('checked'); count++; }
                    if (i === now.getDate()) day.classList.add('today');
                    day.innerText = i;
                    grid.appendChild(day);
                }
                const streakPct = Math.round((count / daysInMonth) * 100);
                $('monthStreakVal').innerText = streakPct + '%';
                $('monthBar').style.width = streakPct + '%';
            });
        }

        // Leaderboard
        function loadLeaderboard() {
            db.ref('users').orderByChild('points').limitToLast(50).on('value', snap => {
                const users = [];
                snap.forEach(child => users.push({ id: child.key, ...child.val() }));
                users.reverse();
                $('leaderboardList').innerHTML = users.map((u, i) => `
        <div class="leaderboard-item" onclick="openPrivateChat('${u.id}', '${u.username}')">
          <span class="rank">#${i + 1}</span>
          <span class="name">${u.username}</span>
          <span class="score">${u.consistency || 0}%</span>
        </div>
      `).join('');
            });
        }

        // Chat Sub-navigation
        $('showPublicChat').onclick = () => {
            $('publicChatPanel').style.display = 'block';
            $('privateChatPanel').style.display = 'none';
        };
        $('showPrivateChat').onclick = () => {
            $('publicChatPanel').style.display = 'none';
            $('privateChatPanel').style.display = 'block';
            // Load existing conversations if needed
            $('privateList').innerHTML = '<div class="small-note">Select an athlete from Ranks to chat.</div>';
        };

        // Chat Logic
        function loadPublicMessages() {
            db.ref('public_chat').limitToLast(50).on('value', snap => {
                let html = '';
                snap.forEach(child => {
                    const m = child.val();
                    const isMe = m.uid === currentUser.uid;
                    html += `<div class="bubble ${isMe ? 'me' : 'other'}">${!isMe ? '<span class="sender">' + m.name + '</span>' : ''}${m.text}</div>`;
                });
                $('publicMessages').innerHTML = html;
                $('publicMessages').scrollTop = $('publicMessages').scrollHeight;
            });
        }

        $('sendPublicBtn').onclick = () => {
            const text = $('publicMsgInput').value.trim();
            if (!text || !currentProfile) return;
            db.ref('public_chat').push({ uid: currentUser.uid, name: currentProfile.username, text, ts: Date.now() });
            $('publicMsgInput').value = '';
        };

        function openPrivateChat(uid, username) {
            if (uid === currentUser.uid) return;
            activePrivateChatUid = uid;
            $('chatInterface').style.display = 'block';
            $('privateList').style.display = 'none';
            $('activeChatName').innerText = username;
            const chatId = [currentUser.uid, uid].sort().join('_');
            db.ref('private_chats/' + chatId).off(); // clean prev
            db.ref('private_chats/' + chatId).on('value', snap => {
                let html = '';
                snap.forEach(child => {
                    const m = child.val();
                    html += `<div class="bubble ${m.uid === currentUser.uid ? 'me' : 'other'}">${m.text}</div>`;
                });
                $('privateMessages').innerHTML = html;
                $('privateMessages').scrollTop = $('privateMessages').scrollHeight;
            });
            // switch tab to social
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.querySelector('.nav-item[data-section="chatSection"]').classList.add('active');
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            $('chatSection').classList.add('active');
        }

        $('backToPrivateList').onclick = () => {
            $('chatInterface').style.display = 'none';
            $('privateList').style.display = 'block';
        };

        $('sendPrivateBtn').onclick = () => {
            const text = $('privateMsgInput').value.trim();
            if (!text || !activePrivateChatUid) return;
            const chatId = [currentUser.uid, activePrivateChatUid].sort().join('_');
            db.ref('private_chats/' + chatId).push({ uid: currentUser.uid, text, ts: Date.now() });
            $('privateMsgInput').value = '';
        };

        // Food Search
        $('foodSearchBtn').onclick = () => searchFoods();
        $('foodSearchInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') searchFoods(); });
        function searchFoods() {
            const query = $('foodSearchInput').value.toLowerCase();
            const results = foodDB.filter(f =>
                f.name.toLowerCase().includes(query) ||
                (f.alt && f.alt.toLowerCase().includes(query))
            );
            $('foodResults').innerHTML = results.map(f => `
      <div class="food-item">
        <div class="food-info"><span class="food-name">${f.name}</span><span class="food-meta">${f.cat}</span></div>
        <div class="food-stats">üí™ ${f.protein}g | üî• ${(f.kcal || f.cal)}cal</div>
      </div>
    `).join('') || '<div class="small-note">No food found in "Swing" local database.</div>';
        }

        // Settings & Modals
        $('editProteinBtn').onclick = () => $('goalModal').style.display = 'flex';
        $('setGoalBtn').onclick = () => $('goalModal').style.display = 'flex';
        $('closeGoalModal').onclick = () => $('goalModal').style.display = 'none';
        $('saveGoalBtn').onclick = () => {
            const newGoal = parseInt($('newGoalInput').value);
            if (!newGoal) return;
            db.ref('users/' + currentUser.uid).update({ proteinGoal: newGoal });
            $('goalModal').style.display = 'none';
        };

        $('editNameBtn').onclick = () => {
            $('newNameInput').value = currentProfile.username;
            $('nameModal').style.display = 'flex';
        };
        $('closeNameModal').onclick = () => $('nameModal').style.display = 'none';
        $('saveNameBtn').onclick = () => {
            const newName = $('newNameInput').value.trim();
            if (!newName) return;
            db.ref('users/' + currentUser.uid).update({ username: newName });
            $('nameModal').style.display = 'none';
        };

        $('logoutBtn').onclick = () => auth.signOut();

        // Search People
        $('searchPeopleBtn').onclick = () => {
            const q = $('searchPeopleInput').value.toLowerCase();
            db.ref('users').once('value', snap => {
                let html = '';
                snap.forEach(child => {
                    const u = child.val();
                    if (u.username && u.username.toLowerCase().includes(q) && child.key !== currentUser.uid) {
                        html += `<div class="leaderboard-item" onclick="openPrivateChat('${child.key}', '${u.username}')"><span class="name">${u.username}</span><i class="fas fa-comment" style="color:#ff7b4a;"></i></div>`;
                    }
                });
                $('searchResults').innerHTML = html || '<div class="small-note">No athlete found.</div>';
            });
        };

    </script>
</body>

</html>
